{% extends "base.html" %}

{% block title %}Animais - Centro de Ado√ß√£o{% endblock %}

{% block content %}
<!-- Bot√£o Flutuante -->
<button class="btn-floating-add" onclick="openModal('addAnimalModal')">
    <span class="btn-text">Adicionar Animal</span>
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
        <path d="M7 0C3.13 0 0 3.13 0 7C0 10.87 3.13 14 7 14C10.87 14 14 10.87 14 7C14 3.13 10.87 0 7 0ZM10.5 7.5H7.5V10.5H6.5V7.5H3.5V6.5H6.5V3.5H7.5V6.5H10.5V7.5Z" fill="white"/>
    </svg>
</button>

<!-- CONTENT AREA -->
<div class="content-area">
    <!-- ANIMAL LIST -->
    <div class="animal-list">
        <div class="list-header">
            <h2>Lista de Animais</h2>
            <input
                type="text"
                class="search-box"
                id="searchAnimals"
                placeholder="üîç Buscar por nome, ra√ßa..."
            >
            <div class="filters">
                <button class="filter-btn active" data-filter="all">Todos</button>
                <button class="filter-btn" data-filter="dog">üêï C√£es</button>
                <button class="filter-btn" data-filter="cat">üê± Gatos</button>
                <button class="filter-btn" data-filter="available">‚úì Dispon√≠veis</button>
            </div>
        </div>

        <div id="animalList">
            {% for animal in animals %}
            <div class="animal-card" data-animal-id="{{ animal.id }}" data-especie="{{ animal.especie.lower() }}" onclick="carregarDetalhesAnimal({{ animal.id }})">
                <div class="animal-card-header">
                    <div
                        class="animal-photo"
                        style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"
                    ></div>
                    <div class="animal-info">
                        <div class="animal-name">{{ animal.nome }}</div>
                        <div class="animal-details">{{ animal.raca }} ‚Ä¢ {{ animal.idade }} {% if animal.idade == 1 %}ano{% else %}anos{% endif %}</div>
                        <div class="animal-details">{{ animal.especie }}</div>
                    </div>
                </div>
                {% if animal.status == 'Em Processo' %}
                <span class="badge badge-process">‚óè Em Processo</span>
                {% elif animal.status == 'Em Tratamento' %}
                <span class="badge badge-treatment">‚óè Em Tratamento</span>
                {% else %}
                <span class="badge badge-available">‚óè Dispon√≠vel</span>
                {% endif %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">üêæ</div>
                <div class="empty-text">Nenhum animal cadastrado</div>
                <div class="empty-subtext">Clique em "Adicionar Animal" para come√ßar</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- DETAIL PANEL -->
    <div class="detail-panel" id="detailPanel">
        <div class="empty-state">
            <div class="empty-icon">üìã</div>
            <div class="empty-text">Selecione um animal</div>
            <div class="empty-subtext">Clique em um animal na lista para ver os detalhes</div>
        </div>
    </div>
</div>

<!-- Modal para Adicionar Animal -->
<div id="addAnimalModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Adicionar Novo Animal</h2>
            <button class="modal-close" onclick="closeModal('addAnimalModal')">‚úï</button>
        </div>
        <form id="addAnimalForm">
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nome do Animal</label>
                    <input type="text" class="form-control" name="nome" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Esp√©cie</label>
                    <select class="form-control" name="especie" required>
                        <option value="">Selecione...</option>
                        <option value="Cachorro">Cachorro</option>
                        <option value="Gato">Gato</option>
                        <option value="Coelho">Coelho</option>
                        <option value="P√°ssaro">P√°ssaro</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ra√ßa</label>
                    <input type="text" class="form-control" name="raca" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Idade (anos)</label>
                    <input type="number" class="form-control" name="idade" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Porte</label>
                    <select class="form-control" name="porte" required>
                        <option value="">Selecione o porte...</option>
                        <option value="Pequeno">Pequeno</option>
                        <option value="M√©dio">M√©dio</option>
                        <option value="Grande">Grande</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Estado de Sa√∫de</label>
                    <input type="text" class="form-control" name="saude" placeholder="Ex: Saud√°vel, Vacinado...">
                </div>
                <div class="form-group">
                    <label class="form-label">Tra√ßos de Personalidade</label>
                    <div id="personalidadeAddAnimal"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Data de Chegada</label>
                    <input type="date" class="form-control" name="data" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-control" name="status" required>
                        <option value="Dispon√≠vel">Dispon√≠vel</option>
                        <option value="Em Processo">Em Processo</option>
                        <option value="Em Tratamento">Em Tratamento</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addAnimalModal')">Cancelar</button>
                <button type="submit" class="btn btn-primary">Adicionar Animal</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal para Editar Animal -->
<div id="editAnimalModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Editar Animal</h2>
            <button class="modal-close" onclick="closeModal('editAnimalModal')">‚úï</button>
        </div>
        <form id="editAnimalForm">
            <input type="hidden" id="editAnimalId" name="animalId">
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nome do Animal</label>
                    <input type="text" class="form-control" id="editNome" name="nome" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Esp√©cie</label>
                    <select class="form-control" id="editEspecie" name="especie" required>
                        <option value="">Selecione...</option>
                        <option value="Cachorro">Cachorro</option>
                        <option value="Gato">Gato</option>
                        <option value="Coelho">Coelho</option>
                        <option value="P√°ssaro">P√°ssaro</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ra√ßa</label>
                    <input type="text" class="form-control" id="editRaca" name="raca" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Idade (anos)</label>
                    <input type="number" class="form-control" id="editIdade" name="idade" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Porte</label>
                    <select class="form-control" id="editPorte" name="porte" required>
                        <option value="">Selecione o porte...</option>
                        <option value="Pequeno">Pequeno</option>
                        <option value="M√©dio">M√©dio</option>
                        <option value="Grande">Grande</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Estado de Sa√∫de</label>
                    <input type="text" class="form-control" id="editSaude" name="saude" placeholder="Ex: Saud√°vel, Vacinado...">
                </div>
                <div class="form-group">
                    <label class="form-label">Tra√ßos de Personalidade</label>
                    <div id="personalidadeEditAnimal"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Data de Chegada</label>
                    <input type="date" class="form-control" id="editData" name="data" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-control" id="editStatus" name="status" required>
                        <option value="Dispon√≠vel">Dispon√≠vel</option>
                        <option value="Em Processo">Em Processo</option>
                        <option value="Em Tratamento">Em Tratamento</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editAnimalModal')">Cancelar</button>
                <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal para Adicionar Tarefa -->
<div id="addTaskModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Adicionar Nova Tarefa</h2>
            <button class="modal-close" onclick="closeModal('addTaskModal')">‚úï</button>
        </div>
        <form id="addTaskForm" class="modal-body">
            <div class="form-group">
                <label class="form-label">Selecione o Animal</label>
                <select class="form-control" id="animalSelect" name="animal_id" required>
                    <option value="">Carregando animais...</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Tipo de Tarefa</label>
                <select class="form-control" name="tarefa" required>
                    <option value="">Selecione...</option>
                    <option value="Banho">üõÅ Banho</option>
                    <option value="Tosa">‚úÇÔ∏è Tosa</option>
                    <option value="Vacina√ß√£o">üíâ Vacina√ß√£o</option>
                    <option value="Check-Up">üè• Check-Up</option>
                    <option value="Treinamento">üéì Treinamento</option>
                    <option value="Castra√ß√£o">üî™ Castra√ß√£o</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Data Prevista</label>
                <input type="date" class="form-control" name="data" required>
            </div>
            <div class="form-group">
                <label class="form-label">Respons√°vel</label>
                <input type="text" class="form-control" name="responsavel" placeholder="Nome da pessoa respons√°vel" required>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addTaskModal')">Cancelar</button>
                <button type="submit" class="btn btn-primary">Adicionar Tarefa</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal overlay -->
<div id="modalOverlay" class="modal-overlay hidden" onclick="closeAllModals()"></div>

{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/personality-traits.js') }}"></script>
<script src="{{ url_for('static', filename='js/animals.js') }}"></script>
<script src="{{ url_for('static', filename='js/tasks.js') }}"></script>

<script>
/**
 * Carrega lista de animais no dropdown quando o modal √© aberto
 */
function carregarAnimaisNoDropdown() {
    const select = document.getElementById('animalSelect');

    fetch('/api/animals')
        .then(response => response.json())
        .then(animais => {
            if (animais.length === 0) {
                select.innerHTML = '<option value="">Nenhum animal cadastrado</option>';
                select.disabled = true;
            } else {
                select.innerHTML = '<option value="">Selecione um animal...</option>';
                animais.forEach(animal => {
                    const option = document.createElement('option');
                    option.value = animal.id;
                    option.textContent = `${animal.nome} (${animal.especie} - ${animal.raca})`;
                    select.appendChild(option);
                });
                select.disabled = false;
            }
        })
        .catch(error => {
            console.error('Erro ao carregar animais:', error);
            select.innerHTML = '<option value="">Erro ao carregar animais</option>';
            select.disabled = true;
        });
}

// Interceptar abertura do modal de adicionar tarefa
const addTaskBtn = document.querySelector('button[onclick="openModal(\'addTaskModal\')"]');
if (addTaskBtn) {
    addTaskBtn.addEventListener('click', function() {
        setTimeout(carregarAnimaisNoDropdown, 100);
    });
}

// Renderizar sliders de personalidade nos formul√°rios
function inicializarPersonalidadeFormsAnimals() {
    // Add animal form
    const addDiv = document.getElementById('personalidadeAddAnimal');
    if (addDiv) {
        addDiv.innerHTML = renderizarTodosSliders();
        inicializarSlidersListener();
    }

    // Edit animal form
    const editDiv = document.getElementById('personalidadeEditAnimal');
    if (editDiv) {
        editDiv.innerHTML = renderizarTodosSliders();
        inicializarSlidersListener();
    }
}

// Renderizar formul√°rio de editar animal com dados atuais
// (A l√≥gica de edi√ß√£o est√° no main.js na fun√ß√£o editarAnimal())

// Carregar animais tamb√©m quando a p√°gina carrega (para caso de reload)
document.addEventListener('DOMContentLoaded', function() {
    carregarAnimaisNoDropdown();
    inicializarPersonalidadeFormsAnimals();
});
</script>
{% endblock %}
